Private Sub Form_Load()
    ' TESTING VERSION - Uses LDB file detection
    Dim ldbSize As Long
    Dim ldbPath As String
    Dim msg As String
    Dim isActive As Boolean
    
    ' Get LDB file info
    ldbPath = GetLDBPath()
    ldbSize = GetLDBFileSize()
    
    ' Determine if another user is active
    ' Each user takes ~64 bytes in the LDB file
    ' If file is > 100 bytes, multiple users are connected
    isActive = (ldbSize > 100)
    
    ' Build diagnostic message
    msg = "=== MULTI-USER DETECTION TEST ===" & vbCrLf & vbCrLf
    msg = msg & "Current User: " & Environ("USERNAME") & vbCrLf
    msg = msg & "Computer: " & Environ("COMPUTERNAME") & vbCrLf
    msg = msg & "LDB File Size: " & ldbSize & " bytes" & vbCrLf
    msg = msg & "LDB Path: " & ldbPath & vbCrLf & vbCrLf
    
    If ldbSize > 0 Then
        msg = msg & "Estimated Users: " & Int(ldbSize / 64) & vbCrLf
    End If
    
    msg = msg & "Another User Active: " & isActive
    
    ' ALWAYS show diagnostic during testing
    MsgBox msg, vbInformation, "Database Status"
    
    ' If another user detected, close form
    If isActive Then
        MsgBox "Another user is currently working in the database." & vbCrLf & vbCrLf & _
               "To prevent data conflicts, only one user can create orders at a time." & vbCrLf & vbCrLf & _
               "Please try again in a few minutes.", _
               vbExclamation + vbOKOnly, _
               "Database In Use"
        
        DoCmd.Close acForm, Me.Name, acSaveNo
    End If
End Sub

Private Function GetLDBPath() As String
    ' Returns the path to the LDB lock file
    Dim dbPath As String
    
    dbPath = CurrentDb.Name
    
    ' Replace .accdb extension with .ldb
    GetLDBPath = Left(dbPath, Len(dbPath) - 6) & ".ldb"
End Function

Private Function GetLDBFileSize() As Long
    ' Returns the size of the LDB file in bytes
    ' Returns 0 if file doesn't exist
    Dim ldbPath As String
    Dim fso As Object
    
    On Error Resume Next
    
    ldbPath = GetLDBPath()
    Set fso = CreateObject("Scripting.FileSystemObject")
    
    If fso.FileExists(ldbPath) Then
        GetLDBFileSize = fso.GetFile(ldbPath).Size
    Else
        GetLDBFileSize = 0
    End If
    
    On Error GoTo 0
End Function
